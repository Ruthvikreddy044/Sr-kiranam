<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing System - S R Kiranam & General Stores</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        #output {
            border: 1px solid rgb(45, 14, 216);
            padding: 10px;
            margin-top: 20px;
        }
        #items img {
            width: 100px;
            margin: 10px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        #items img.selected {
            border-color: red;
        }
        input, button {
            margin: 10px;
            padding: 8px;
            font-size: 16px;
        }
        .header h1 {
            margin-bottom: 0;
        }
        .Pro {
            margin: 2px 0;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>Welcome to S R Kiranam & General Stores</h1>
        <h3 class="Pro">Pro. SRINIVASREDDY</h3>
        <h3 class="Pro">üìû 6301508191</h3>
    </div>

    <h3>Select a Product:</h3>
    <div id="items">
        <img src="rice.jpg" alt="Rice" onclick="selectItem('rice', this)">
        <img src="maida.jpg" alt="Maida" onclick="selectItem('maida', this)">
        <img src="milk.jpg" alt="Milk" onclick="selectItem('milk', this)">
        <img src="OIL.jpg.webp" alt="Oil Packet" onclick="selectItem('oil packet', this)">
        <img src="chilli.jpg" alt="Chilli Powder" onclick="selectItem('chilli powder', this)">
        <img src="chocolate.jpg" alt="Chocolate" onclick="selectItem('chocolate', this)">
        <img src="chips.jpg" alt="Chips" onclick="selectItem('chips', this)">
        <img src="thumsup.jpg" alt="Thumsup" onclick="selectItem('thumsup', this)">
    </div>

    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" value="1" min="1">

    <div>
        <button onclick="addToCart()">Add to Cart</button>
        <button onclick="finalizeBill()">Finalize Bill</button>
    </div>

    <div id="customerDetails" style="display: none;">
        <label for="phone">Enter Phone Number:</label>
        <input type="tel" id="phone" pattern="[0-9]{10}" required>
        <button onclick="sendSMS()">Send SMS</button>
    </div>

    <div id="output"></div>

    <script>
        const items = {
            "rice": { "fare": 60.00, "available": 50 },
            "maida": { "fare": 35.00, "available": 100 },
            "milk": { "fare": 60.00, "available": 80 },
            "oil packet": { "fare": 160.00, "available": 40 },
            "chilli powder": { "fare": 240.00, "available": 30 },
            "chocolate": { "fare": 10.00, "available": 20 },
            "chips": { "fare": 15.00, "available": 10 },
            "thumsup": { "fare": 110.00, "available": 25 }
        };

        let cart = [];
        let selectedItem = "";

        function selectItem(item, imgElement) {
            selectedItem = item;
            document.querySelectorAll("#items img").forEach(img => img.classList.remove("selected"));
            imgElement.classList.add("selected");
        }

        function addToCart() {
            if (!selectedItem) {
                alert("Please select a product.");
                return;
            }

            let quantity = parseInt(document.getElementById("quantity").value);
            if (quantity <= 0) {
                alert("Quantity must be at least 1.");
                return;
            }

            if (quantity > items[selectedItem].available) {
                alert("Not enough stock available!");
                return;
            }

            items[selectedItem].available -= quantity;
            cart.push({ item: selectedItem, quantity: quantity });
            updateCart();
        }

        function updateCart() {
            let output = document.getElementById("output");
            let totalAmount = 0;
            output.innerHTML = "<hr><h3>Current Cart:</h3>";

            cart.forEach(entry => {
                const cost = items[entry.item]["fare"] * entry.quantity;
                totalAmount += cost;
                output.innerHTML += `<p>${entry.item} x ${entry.quantity} = ‚Çπ${cost.toFixed(2)}</p>`;
            });

            output.innerHTML += `<hr><h3>Total Amount: ‚Çπ${totalAmount.toFixed(2)}</h3>`;
        }

        function finalizeBill() {
            let output = document.getElementById("output");
            output.innerHTML = "<h2>***** S R KIRANAM & GENERAL STORES *****</h2>";
            output.innerHTML += "<p>Thank you for visiting! üôè</p><hr>";
            updateCart();
            document.getElementById("customerDetails").style.display = "block";
        }

        function sendSMS() {
            const phone = document.getElementById("phone").value.trim();
            if (!/^\d{10}$/.test(phone)) {
                alert("Enter a valid 10-digit phone number.");
                return;
            }

            const totalAmount = cart.reduce((sum, entry) => sum + items[entry.item]["fare"] * entry.quantity, 0);
            const message = `Your bill is finalized. Total: ‚Çπ${totalAmount.toFixed(2)}. Thank you for shopping!`;

            fetch("http://localhost:3000/sendsms", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    phone: `+91${phone}`,
                    message: message
                })
            })
            .then(response => response.json())
            .then(data => alert(data.status))
            .catch(error => alert("Failed to send SMS: " + error.message));
        }
    </script>

</body>
</html>
